# Token minting
Cardano offers a way to create native tokens on the blockchain. We recommend reading the guide [Discover native tokens](https://developers.cardano.org/docs/native-tokens/) before continuing.

## Creating a mint policy
To mint some tokens you first need to define a monetary policy script as it is called in the Cardano guide, or put simply a script which says who is eligible to mint and burn tokens.
In this guide we will create a policy which will require two signatures, one will be a public key derived on a hardware wallet, and one will be a public key created via `cardano-cli`.

### Public keys
To generate the public key on a hardware wallet a `1855H` path should be used as described in [CIP-1855](https://github.com/cardano-foundation/CIPs/blob/master/CIP-1855/CIP-1855.md):
```sh
cardano-hw-cli address key-gen \
--path 1855H/1815H/0H \
--verification-key-file mint-hw.vkey \
--hw-signing-file mint-hw.hwsfile
```

The second key for the purpose of this demo will be a `cardano-cli` generated one.
```sh
cardano-cli address key-gen \
--normal-key \
--verification-key-file mint-cli.vkey \
--signing-key-file mint-cli.skey
```

Note: this is just an example, you can create scripts even with two keys generated by two different hardware wallets.

### Policy native script
With our keys generated we can create the policy native script:
```sh
cat >policy.script <<EOF
{
  "type": "all",
  "scripts": [
    {
      "type": "sig",
      "keyHash": "$(cardano-cli address key-hash --payment-verification-key-file mint-hw.vkey)"
    },
    {
      "type": "sig",
      "keyHash": "$(cardano-cli address key-hash --payment-verification-key-file mint-cli.vkey)"
    }
  ]
}
EOF
```

### Policy id
In the transaction we are about to create we will also be using the hash of the native script, also called the policy id. To create it we can use this command:
```sh
cardano-hw-cli transaction policyid \
--script-file policy.script \
--hw-signing-file mint-ledger.hwsfile >policyId
```
The `--hw-signing-file` argument is optional, but enables the hardware wallet to show you the path of the public key instead of it's hash where available.

## Creating a transaction with token minting
*Note: This part of the guide assumes you already have some funded address from which you are going to make this transaction, located in a file named `payment.addr`.*
In this transaction we are going to mint `1000000` tokens named `C0in`.

### Querying the UTxO
First as with every transaction you need to query for the UTxO (substitute `--mainnet` for `--testnet-magic 1097911063` if you are using testnet):
```sh
cardano-cli query utxo \
--address $(cat payment.addr) \
--mainnet
```

Example return:
```
                           TxHash                                 TxIx        Amount
--------------------------------------------------------------------------------------
1626d02eac494bfbbf0b725ad617fca9fa9b6c9f5b6dcd5e62aa1f9cc3efe731     0        995124450 lovelace + TxOutDatumHashNone
```

### Drafting the transaction
Now we can draft the transaction:
```sh
cardano-cli transaction build-raw \
--mary-era \
--tx-in "1626d02eac494bfbbf0b725ad617fca9fa9b6c9f5b6dcd5e62aa1f9cc3efe731#0" \
--tx-out "$(cat payment.addr)"+0+"1000000 $(cat policyId).C0in" \
--mint "1000000 $(cat policyId).C0in" \
--minting-script-file policy.script \
--fee 0 \
--out-file tx.draft
```

### Calculating the fee
*Note: if you don't have a `protocol.json` file available you obtain it with `cardano-cli`:*
```sh
cardano-cli query protocol-parameters \
--out-file protocol.json \
--testnet-magic 1097911063
```

Then we can calculate the fee (substitute `--mainnet` for `--testnet-magic 1097911063` if you are using testnet):
```sh
cardano-cli transaction calculate-min-fee \
--tx-body-file tx.draft  \
--tx-in-count 1 \
--tx-out-count 1 \
--witness-count 3 \
--mainnet \
--protocol-params-file ./protocol.json
```
Example output:
```
200701 Lovelace
```
Note that our policy script is of type all and therefore requires to be signed with all the nested scripts. In this case it means it needs signatures from both the public keys, therefore we need 2 witnesses only for the policy script plus witnesses needed for the payment address (here we assumed the payment address is a ordinary one, but if it was multisig address it could require more signatures).

### Creating the unsigned transaction
Then we can calculate the output amount (input minus the fee) and create the unsigned transaction.
```sh
expr 995124450 - 200701
```
```sh
cardano-cli transaction build-raw \
--mary-era \
--tx-in "1626d02eac494bfbbf0b725ad617fca9fa9b6c9f5b6dcd5e62aa1f9cc3efe731#0" \
--tx-out "$(cat payment.addr)"+994923749+"1000000 $(cat policyId).C0in" \
--mint "1000000 $(cat policyId).C0in" \
--minting-script-file policy.script \
--fee 200701 \
--out-file tx.raw
```

### Signing the transaction
Now we can proceed to signing the transaction. Aside from the witness needed for the payment address, our transaction needs to be signed by the `cardano-cli` generated key and hardware wallet generated one:
```sh
cardano-cli transaction witness \
--tx-body-file tx.raw \
--signing-key-file mint-cli.skey \
--out-file mint-cli.witness \
--mainnet

cardano-hw-cli transaction witness \
--tx-body-file tx.raw \
--hw-signing-file mint-hw.hwsfile \
--out-file mint-hw.witness \
--mainnet
```
We should now have two witness files available `mint-cli.witness` and `mint-hw.witness` and together with any other witnesses we can assemble them together into a signed transaction:
```
cardano-cli transaction assemble \
--tx-body-file tx.raw \
--witness-file payment.witness \
--witness-file mint-hw.witness \
--witness-file mint-cli.witness \
--out-file tx.signed
```
The `--witness-file payment.witness` is just an example, you might have more of other required witnesses or have them named differently.

### Submitting the transaction
We can now submit the signed transaction onto the blockchain:
```sh
cardano-cli transaction submit \
--tx-file tx.signed \
--mainnet
```
